{
  "assignee": "",
  "blocked_by": [],
  "blocks": [],
  "created": "2026-02-20T20:33:58Z",
  "description": "## Problem\n\nNo way to append context to an issue. The description is a single overwrite field. Agents need to record 'tried X, failed because Y' as they work. A comments array in the JSON with timestamp and text is the minimal version. This is the biggest gap for agent workflows -- context accumulates during a session and has nowhere to go.\n\n## bd alignment\n\nbd comments \u003cid\u003e lists comments, bd comments add \u003cid\u003e 'text' adds one. bd show includes a COMMENTS section. bd show --json embeds comments in the issue object under 'comments' array. bd comments --json returns [{id, issue_id, author, text, created_at}].\n\nWe match the subcommand pattern. bw is simpler (no integer comment IDs, no issue_id field), but we add an optional Author field for bd export/import roundtrip fidelity. The git commit author provides who/when for native bw comments.\n\n## Implementation\n\n### Data model (internal/issue/issue.go)\n- Add Comment struct:\n    type Comment struct {\n        Text      string json:'text'\n        Author    string json:'author,omitempty'\n        Timestamp string json:'timestamp'\n    }\n- Add Comments []Comment to Issue struct (json: 'comments,omitempty')\n- Add Store.Comment(id, text, author string) (*Issue, error):\n  - resolveID, readIssue\n  - Append Comment{Text: text, Author: author, Timestamp: now}\n  - Set UpdatedAt = now\n  - writeIssue\n  - Return updated issue\n\n### CLI (cmd/bw/comments.go) -- new file\n- Dispatches on first positional:\n  - 'add' -\u003e add subcommand: bw comments add \u003cid\u003e 'text' [--author NAME]\n  - otherwise -\u003e list subcommand: bw comments \u003cid\u003e\n- List mode: load issue, print each comment with timestamp + author (if set) + text\n- Add mode: call store.Comment(), commit with intent 'comment \u003cid\u003e \"text\"'\n- Flags: --json (both modes), --author (add mode only, optional)\n\n### Display (cmd/bw/helpers.go)\n- In fprintIssue, after description section, render COMMENTS block:\n    COMMENTS\n      2026-02-20 19:51 alice\n        Testing comment format\n\n      2026-02-20 20:03\n        Comment without author\n\n### Export/Import (cmd/bw/export.go, cmd/bw/import.go)\n- Add exportComment struct mapping to bd format: {author, text, created_at}\n- Add Comments []exportComment to beadsRecord\n- Export: map issue.Comments -\u003e beadsRecord.Comments (Timestamp -\u003e created_at)\n- Import: add Comments to importRecord, map created_at -\u003e Timestamp, author -\u003e Author\n- This enables bd-\u003ebw-\u003ebd comment roundtripping\n\n### Intent replay (internal/intent/intent.go)\n- Add case 'comment': in replayOne switch\n- replayComment: parse 'comment \u003cid\u003e \"text\"', extract quoted text via ExtractQuoted, call store.Comment(id, text, '')\n\n### Command registration (cmd/bw/command.go)\n- Add to commands array with subcommand positionals\n- Add 'comments' to 'Working With Issues' group in commandGroups\n\n## Acceptance criteria\n\n- [ ] bw comments add \u003cid\u003e 'note' adds a comment with current timestamp\n- [ ] bw comments \u003cid\u003e lists all comments with timestamp and text\n- [ ] bw comments \u003cid\u003e --json outputs [{text, timestamp, author?}]\n- [ ] bw comments add \u003cid\u003e 'note' --author 'alice' stores the author\n- [ ] bw show \u003cid\u003e renders COMMENTS section after description\n- [ ] bw show \u003cid\u003e --json includes comments array in issue object\n- [ ] Comments with author display as '2026-02-20 19:51 alice' in output\n- [ ] Comments without author display as '2026-02-20 19:51' in output\n- [ ] bw comments nonexistent returns error\n- [ ] bw comments add \u003cid\u003e (no text) returns usage error\n- [ ] Intent: comment creates a git commit with 'comment \u003cid\u003e \"text\"' message\n- [ ] Intent replay correctly applies comment intents\n- [ ] Export: bw export includes comments in JSONL (created_at format for bd compat)\n- [ ] Import: bw import reads comments from JSONL and stores them\n- [ ] Roundtrip: export -\u003e import preserves comments with author and timestamp\n- [ ] Empty comments array is omitted from JSON (omitempty)\n\n## Test requirements\n\n- Unit test for Store.Comment appending to empty comments\n- Unit test for Store.Comment appending to existing comments\n- Unit test for Store.Comment with and without author\n- Unit test for Store.Comment on nonexistent issue\n- Unit test for comments list output (plain text)\n- Unit test for comments list output (JSON)\n- Unit test for comments add output\n- Unit test for fprintIssue rendering COMMENTS section\n- Unit test for fprintIssue with no comments (section omitted)\n- Unit test for export including comments\n- Unit test for import including comments\n- Unit test for intent replay of comment\n- Existing tests pass (go test ./...)",
  "id": "bw-m0a",
  "labels": [],
  "priority": 1,
  "status": "open",
  "title": "Add bw comments subcommand",
  "type": "feature",
  "updated_at": "2026-02-20T20:33:58Z"
}
